<head>
    <style type="text/css">
        #header {
            width:100%;
            display:block;
            background-color:#0a1f5a;
            vertical-align:bottom;
            height:128px;
        }
        #left_tab {
            display:inline-block;
            vertical-align: top;
        }
        #lastblock {
            display:inline-block;
            margin:4px;
            border:1px solid;
            border-radius:2px;
           vertical-align: top;
           float:right;
         }
        .lbl {
            text-align:right;
        }
       .tx_address {
            font-size:1.2em;
            font-weight:lighter;
            cursor:pointer;
            font-style:italic;
            text-decoration:underline;
        }
        .block_hash{
            font-size:1.0em;
            font-weight:lighter;
            font-family:monospace;
            cursor:pointer;
            font-style:italic;
            text-decoration:underline;
        }
        .tx_hash{
            font-size:1.0em;
            font-weight:lighter;
            font-family:monospace;
            border-bottom:1px solid #000;
        }
        .txhdr{
            font-size:1.0em;
            font-weight:normal;
            font-family:monospace;
            background-color:#808080;
            border:1px solid;
            border-color:#000;
        }
        .txmine {
            text-align:right;
            border-bottom:1px solid #000;
        }

        #blockhash{
            font-size:0.6em;
            font-weight:lighter;
            font-family:monospace;
        }
    </style>
    <script src="/jquery-3.1.1.min.js"></script>
    <script language="javascript">
        var blocks = null;
 	    var txs= null;
 	    var blockTimer = null;

        var unit=1;
        function api_call(in_method,in_params,in_success)
        {
            $.ajax({
                url: '/api/' + in_method+in_params,
                type: "GET",
                dataType: "json",
                success: in_success,
                error: function (err) { alert("Error"); }
            });
        }
        function timeConverter(UNIX_timestamp) {
            var a = new Date(UNIX_timestamp * 1000);
            var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            var year = a.getFullYear();
            var month = months[a.getMonth()];
            var date = a.getDate();
            var hour = a.getHours();
            var min = a.getMinutes();
            var sec = a.getSeconds();
            var time = date + ' ' + month + ' ' + year + ' ' + hour + ':' + min + ':' + sec;
            return time;
        }

        function dateConverter(UNIX_timestamp) {
            var a = new Date(UNIX_timestamp * 1000);
            var months = ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12'];
            var year = a.getFullYear();
            var month = months[a.getMonth()];
            var date = a.getDate();
            var time = year + '-' +month + '-' + date;
            return time;
        }
        function select_menu(id)
        {
            if (id == "tab_block")
                $('#tab_block').addClass('selected');
            else
                $('#tab_block').removeClass('selected');

            if (id == "tab_tx")
                $('#tab_tx').addClass('selected');
            else
                $('#tab_tx').removeClass('selected');
        }
              
       
        function update_txs(txs,tbl_name) {
            var num_txs = txs.length;
            old_tbody = document.getElementById(tbl_name).tBodies[0];
            new_tbody = document.createElement('tbody');


            for (n = 0; n < num_txs; n++) {
                var row = new_tbody.insertRow(n * 2);
                row.className = "txhdr";
               
                cell = row.insertCell(0);
                cell.className = "tx_hash";
                cell.innerHTML = txs[n].txid;

                cell = row.insertCell(1);
                cell.className = "txmine";
                cell.innerHTML = 'mined on ' + timeConverter(txs[n].blocktime);

                row = new_tbody.insertRow(n * 2 + 1);

                if (!txs[n].isCoinBase) {
                    var nins, nouts;
                    var html = '';

                    nins = txs[n].vin.length;
                    for (nn = 0; nn < nins; nn++) {
                        html += '#' + txs[n].vin[nn].n + ' <span onclick="selectAddress(\'' + txs[n].vin[nn].addresses[0] + '\');" class="tx_address">' + txs[n].vin[nn].addresses[0] + '</span>' + txs[n].vin[nn].value / unit + '  <br/>';
                    }
                    cell = row.insertCell(0);
                    cell.className = "txins";
                    cell.innerHTML = html;

                    html = '';
                    nouts = txs[n].vout.length;
                    for (nn = 0; nn < nouts; nn++) {
                        html += '#' + txs[n].vout[nn].n + ' <span onclick="selectAddress(\'' + txs[n].vout[nn].addresses[0] + '\');" class="tx_address">' + txs[n].vout[nn].addresses[0] + '</span> ' + txs[n].vout[nn].value / unit + ' <br/>';
                    }
                    cell = row.insertCell(1);
                    cell.className = "txouts";
                    cell.innerHTML = html;
                }
            }
            old_tbody.parentNode.replaceChild(new_tbody, old_tbody);

        
        }
        
       
        function update_blocks() {
            var nrow;
		    if(blocks==null)return;

		    var num_blocks = blocks.length;
            thead = document.getElementById("list_table").tHead;
            old_tbody = document.getElementById("list_table").tBodies[0];
            new_tbody = document.createElement('tbody');

            nrow = 0;
            for (n = 0; n < num_blocks; n++) {
                if (!blocks[n].height) continue;
                var row = new_tbody.insertRow(nrow);

                cell = row.insertCell(0);
                cell.className = "height";
                cell.innerHTML = blocks[n].height;
                
                cell = row.insertCell(1);
                cell.className = "block_hash";
                cell.innerHTML = blocks[n].hash;

                cell = row.insertCell(2);
                cell.className = "time";
                cell.innerHTML = timeConverter(blocks[n].time);

                cell = row.insertCell(3);
                cell.className = "reward";

                if(blocks[n].isCoinbase)
                    cell.innerHTML = blocks[n].reward / unit + '(mined)';
                else
                    cell.innerHTML = blocks[n].reward / unit + '(staked)';

                cell = row.insertCell(4);
                cell.className = "ntx";
                if (blocks[n].tx)
                    cell.innerHTML = blocks[n].tx.length;

                cell = row.insertCell(5);
                cell.className = "size";
                cell.innerHTML = blocks[n].size;


                nrow++;
            }

            old_tbody.parentNode.replaceChild(new_tbody, old_tbody);

            $('.block_hash').click(function () { selectBlock(this.innerHTML) });
        }



        function updateblock(block)
        {
            $("#confirmations").html(block.confirmations);
            $("#difficulty").html(block.difficulty);
            $("#hash").html(block.hash);
            $("#height").html(block.height);
            $("#merkleroot").html(block.merkleroot);
            $("#nextblockhash").html(block.nextblockhash);
            $("#nonce").html(block.nonce);
            $("#size").html(block.size);
            $("#bits").html('0x' + block.bits.toString(16));
            $("#diffhash").html(block.hbits);
            $("#proofhash").html(block.proofhash);
            $("#stakemodifier2").html(block.stakemodifier2);
            $("#time").html(timeConverter(block.time));
            $("#version").html(block.version);

            $("#txs").empty();
            if (block.tx) {
                ntx = block.tx.length;
                for (n = 0; n < ntx; n++) {
                    $("#txs").append('<div>' + block.tx[n] + '</div>');
                }
            }
            $("#blockhash").html(block.hash);
        }

        function list_addr_txs(addr) {
            api_call('txs', '?address=' + addr, function (data) {
                data.txs.sort(function (a, b) { return (b.time - a.time); });
                update_txs(data.txs,'addr_list');
            });
        }

        function list_txs(hash) {
            api_call('txs', '?block=' + hash, function (data) {
                txs = data.txs;
                update_txs(txs,'tx_list');
            });
        }
        function list_blocks(date) {
            var old_tbody = document.getElementById("list_table").tBodies[0];
            var new_tbody = document.createElement('tbody');
            old_tbody.parentNode.replaceChild(new_tbody, old_tbody);
            api_call('blocks', "?BlockDate=" + date, function (data) {
                blocks = data.blocks;
                blocks.sort(function (a, b) { return (b.time - a.time); });
                update_blocks();
            });
        }

        function selectAddress(saddr) {
            list_addr_txs(saddr.toString());
            $("#address_list").html(saddr);
            
            
            
        }
        function selectBlock(hash) {
            api_call('block', '/'+hash, function (data) {
                var ntx;
                var date;
                lastblock = data.result;
                updateblock     (data);
                list_txs        (data.hash);
            });
        }
        function get_lastblock() {
            api_call('block', '', function (data) {
                var date;
                lastblock = data;
                updateblock(data);
                date = dateConverter(data.time);
                $("#blocklistdate").html(date);
                list_blocks(date);
            });
        }
        $(document).ready(function () {
            get_lastblock();
        });
    </script>
</head>
<body>
    <div id="header"><div style="vertical-align:bottom;"><span>Units : </span><select onchange="unit = this.options[this.selectedIndex].value; update_blocks(); update_txs(txs, 'tx_list');" id="units" name="units"><option value="1">satoshis</option><option value="1000000">cents</option><option value="100000000">coin</option></select></div></div>
  
      <div id="left_tab">
        <h1><span id="blocklistdate"></span></h1>
        <table id="list_table">
            <thead><tr><th>height</th><th>hash</th><th>time</th><th>reward</th><th>ntx</th><th>size</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>
    <div id="lastblock">
        <div><h1>block&nbsp;<span id="blockhash"></span></h1></div>
        <table id="tblblock" >

            <tr><td class="lbl">height :</td> <td id="height"></td></tr>
            <tr><td class="lbl">hash :</td> <td id="hash"></td></tr>
            <tr><td class="lbl">time :</td> <td id="time"></td></tr>
            <tr><td class="lbl">confirmations :</td> <td id="confirmations"></td></tr>
            <tr><td class="lbl">difficulty :</td> <td id="difficulty"></td></tr>
            <tr><td class="lbl">merkleroot :</td> <td id="merkleroot"></td></tr>
            <tr><td class="lbl">nextblockhash :</td> <td id="nextblockhash"></td></tr>
            <tr><td class="lbl">nonce :</td> <td id="nonce"></td></tr>
            <tr><td class="lbl">bits : </td><td id="bits"></td></tr>
            <tr><td class="lbl">difficulty hash :</td> <td id="diffhash"></td></tr>
            <tr><td class="lbl">proofhash :</td> <td id="proofhash"></td></tr>
            <tr><td class="lbl">size :</td> <td id="size"></td></tr>
            <tr><td class="lbl">stakemodifier2 :</td> <td id="stakemodifier2"></td></tr>

            <tr><td class="lbl">version :</td> <td id="version"></td></tr>
            <tr><td class="lbl">txs :</td> <td id="txs"></td></tr>
        </table>
        <table id="tx_list" cellpadding="0" cellspacing="0" border="0">
            <thead><tr><th colspan="2"><h1>transactions</h1></th></tr></thead>
            <tbody></tbody>
        </table>

        <div><h1>address&nbsp;<span id="address_list"></span></h1></div>

        <table id="addr_list" cellpadding="0" cellspacing="0" border="0">
            <thead><tr><th colspan="2"><h1>transactions</h1></th></tr></thead>
            <tbody></tbody>
        </table>
    </div>
</body>